---
title: "Assignment 5 - Data wrangling"
subtitle: '2030071 - 1753320'
author: "Group 50: Rom√©e Simons and Tycho Brouwer"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: cosmo
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    number_sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#the needed packages are:
library(knitr)
library(kableExtra)
library(tidyverse)
library(readxl)

set.seed(30250) #makes sure random numbers are reproducible

```

# Task 1

```{r, load data}
data_raw <- read_xlsx("data.xlsx")

```


```{r, plot}
data_filtered = data_raw[!data_raw$VCL6 == 1, ]
data_filtered = data_raw[!data_raw$VCL9 == 1, ]
data_filtered = data_raw[!data_raw$VCL12 == 1, ]
data_filtered$education = as.factor(data_filtered$education)

data_filtered |>
  mutate(VCL = VCL1 + VCL2 + VCL3 + VCL4 + VCL5 + VCL6 + VCL7 + VCL8 + VCL9 + VCL10 + VCL11 + VCL12 + VCL13 + VCL14 + VCL15 + VCL16) |>
  mutate(`Education Level` = recode(education,
                                    "0" = "No answer",
                                    "1" = "Less than high school",
                                    "2" = "High school",
                                    "3" = "University degree",
                                    "4" = "Graduate degree" )) |>
  group_by(`Education Level`) |>
  summarise(
    Observations = n(),
    `Average Number of Words` = round(mean(VCL, na.rm = TRUE), 2),
    `SD`  = round(sd(VCL, na.rm = TRUE), 2),
    .groups = "drop"
  ) |>
  knitr::kable(caption = "The average number of known words for different education levels") |>
  kable_classic() |>
  kable_styling(full_width = FALSE, font_size = 20) 
```

# Task 2

```{r}
data_filtered |>
  mutate(Depression = Q3A + Q5A + Q10A + Q13A + Q16A + Q17A + Q21A + Q24A + Q26A + Q31A + Q34A + Q37A + Q38A + Q42A - 14) |>
  mutate(Anxiety = Q2A + Q4A + Q7A + Q9A + Q15A + Q19A + Q20A + Q23A + Q25A + Q28A + Q30A + Q36A + Q40A + Q41A - 14) |>
  mutate(Stress = Q1A + Q6A + Q8A + Q11A + Q12A + Q14A + Q18A + Q22A + Q27A + Q29A + Q32A + Q33A + Q35A + Q39A -14) |>
  filter(
    education == 2 & urban == 1 | education == 4 & urban == 3
  ) |>
  mutate(`Education Level` = recode(education,
                                    "0" = "No answer",
                                    "1" = "Less than high school",
                                    "2" = "High school",
                                    "3" = "University degree",
                                    "4" = "Graduate degree" )) |>
  mutate(`Environment` = recode(urban,
                                "0" = "No answer",
                                "1" = "Rural",
                                "2" = "Suburban",
                                "3" = "Urban" )) |>
  group_by(`Education Level`, `Environment`) |>
  summarise(
    Observations = n(),
    `Average Depression Score` = round(mean(Depression, na.rm = TRUE), 2),
    `Average Anxiety Score` = round(mean(Anxiety, na.rm = TRUE), 2),
    `Average Stress Score` = round(mean(Stress, na.rm = TRUE), 2),
    .groups = "drop"
  ) |>
  knitr::kable(caption = "Comparision between urban people with a graduate degree and rural people with a high school level degree") |>
  kable_classic() |>
  kable_styling(full_width = FALSE, font_size = 20) 
```

# Task 3

```{r}
r1<-str_detect(data_filtered$major, "gine")
r<-as.numeric(r1)

data_raw <- bind_cols(data_filtered, r)
data_raw <- data_raw |> rename(engineer=...173)

data_raw$hand <- case_match(
  data_raw$hand,
  1 ~ 0,
  2 ~ 1,
  3 ~ 0,
  .default = NA
)

data_raw$engineer <- case_match(
  data_raw$engineer,
  0 ~ "other major",
  1 ~ "engineer",
  NA ~ "no major"
)

lefthand <- data_raw |>
  group_by(engineer) |>
  summarise(
    n = n(),
    avg_hand = mean(hand, na.rm = TRUE),
    .groups = "drop"
  )

kable(lefthand, 
      digits = 2, 
      col.names = c("Engineer", "Number", "Proportion"),
      caption = "A comparision of left-handedness of engineers and non-engineers") |>
  kable_classic() |>
  kable_styling(full_width = FALSE, font_size = 20) 
```

# Task 4

```{r}
data_raw <- data_raw  |>
  mutate(total_time = introelapse + testelapse + surveyelapse)

summ_total <- data_raw |>
  group_by(country) |>
  summarise(
    observations = n(),
    avg_time = mean(total_time, na.rm = TRUE),
    .groups = "drop"
  ) |>
  filter(observations > 100) |>
  filter(observations > 100 & avg_time == max(avg_time))

kable(summ_total, col.names = c("Country", "Observations", "Average Time")) |>
  kable_classic() |>
  kable_styling(full_width = FALSE, font_size = 20)
```





