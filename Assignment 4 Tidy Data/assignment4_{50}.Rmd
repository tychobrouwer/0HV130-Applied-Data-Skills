---
title: "Assignment 4 - Tidy data"
subtitle: '2030071 - 1753320'
author: "Group 50: Romée Simons and Tycho Brouwer"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: cosmo
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    number_sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#the needed packages are: 
library(tidyverse)
library(patchwork)
library(plotly)
library(ggdist)
library(kableExtra)
library(tidyr)
library(plyr)

set.seed(30250) #makes sure random numbers are reproducible

```

# Task 1

For importing the data set, **;** was used as the delimiter, the first 4 lines were skipped, and the final line was skipped by setting the maximum lines read.

Also, the decimal mark was correctly set by setting the locale using the **,** decimal mark.

The data for the **Subject**, the years, are in the character format because they where recognized as the column titles.

The column containing the value **scale** for all it's entries is missing a column title.

The column names should be **Subject**, **Year**, **Score**, and **ScoreType**.

```{r, load data, message=FALSE}
happiness_data <- read_delim(
  'dataset_happiness.csv',
  delim=";",
  show_col_types = FALSE,
  skip = 4,
  n_max = 6,
  locale=locale(decimal_mark = ",")
  ) |> glimpse()
```

# Task 2

```{r}

happiness_data_long <- happiness_data |>
  pivot_longer(cols = `2013`:`2022`,
               names_to = "Year",
               values_to = "Score") |>
  rename(c("...2"="ScoreType")) |>
  glimpse()
```

# Task 3

```{r}
happiness_data_long |>
  ggplot(aes(Year, Score, colour = Subject, group = Subject)) +
  geom_path() +
  ggtitle("Trend of happiness over years") +
   theme_minimal()
```

# Task 4

```{r}
temp_data_wide <- read_delim(
  'data_temp_wide.csv',
  show_col_types = FALSE,
  delim = ","
  )

head(temp_data_wide, 5)
glimpse(temp_data_wide)
```

# Task 5

```{r}
temp_data_wide |>
  pivot_longer(
    cols = city_lower:city_upper,
    names_to = c("ValueType"),
    names_prefix = "city_",
    values_to = "Temp"
  ) |> glimpse()
```

# Task 6

```{r}
temp_data_separated <- temp_data_wide |>
  pivot_longer(
    cols = city_lower:city_upper,
    names_to = c("ValueType"),
    names_prefix = "city_",
    values_to = "Temp"
  ) |>
  separate(col=`Temp`, into = c("City", "Temp"), sep = "_", convert = TRUE) |>
  glimpse()
```

# Task 7

From the plots it can be seen that for all three cities Eindhoven, Rotterdam, and Vlieland the temperature is at its lowest from December to February. Eindhoven has both the coldest day in the winter and hottest day in the summer of the three cities. From the slope of the temperature, it can be seen that the temperature rises slower in the spring than it declines in the fall. Finally, in none of the cities the temperature is consistenly below 0 degrees in the winter.

```{r, echo=FALSE}
temp_data_separated$`date [mm-dd]` = as.Date(temp_data_separated$`date [mm-dd]`, "%m-%d")

temp_data_separated_wider <- temp_data_separated |>
  pivot_wider(
    names_from = ValueType,
    values_from = Temp,
    names_sep = ""
  )

plot_eindhoven <- temp_data_separated_wider[temp_data_separated_wider$City == "Eindhoven",] |>
  ggplot(aes(`date [mm-dd]`, mean, group = City)) +
  geom_line(colour = "red") +
  geom_ribbon(aes(x = `date [mm-dd]`, ymax = upper, ymin = lower), fill = "salmon", alpha = 0.4, colour = NA) +
  scale_x_date(date_labels = "%b") +
  theme(axis.title.x=element_blank()) +
  ylim(0, 30) +
  ylab("Temperature [°C]") +
  labs(subtitle = "Eindhoven")

plot_rotterdam <- temp_data_separated_wider[temp_data_separated_wider$City == "Rotterdam",] |>
  ggplot(aes(`date [mm-dd]`, mean, group = City)) +
  geom_line(colour = "blue") +
  geom_ribbon(aes(x = `date [mm-dd]`, ymax = upper, ymin = lower), fill = "deepskyblue", alpha = 0.4, colour = NA) +
  scale_x_date(date_labels = "%b") +
  theme(axis.title.y=element_blank()) +
  ylim(0, 30) +
  xlab("Date") +
  labs(subtitle = "Rotterdam")

plot_vlieland <- temp_data_separated_wider[temp_data_separated_wider$City == "Vlieland",] |>
  ggplot(aes(`date [mm-dd]`, mean, group = City)) +
  geom_line(colour = "seagreen4") +
  geom_ribbon(aes(x = `date [mm-dd]`, ymax = upper, ymin = lower), fill = "seagreen3", alpha = 0.4, colour = NA) +
  scale_x_date(date_labels = "%b") +
  ylim(0, 30) +
  xlab("Date") +
  ylab("Temperature [°C]") +
  labs(subtitle = "Vlieland")

plot_eindhoven + plot_rotterdam + plot_vlieland +
  plot_layout(nrow = 2, width = c(1,1), guides = "collect") +
  plot_annotation("Mean temperature over a year with minimum and maximum\nin Eindhoven, Rotterdam, and Vlieland.")
```








